<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.elife.feature.mapper.SubscribeMapper">

    <resultMap type="Subscribe" id="SubscribeResult">
        <result property="userId" column="user_id"/>
        <result property="companyId" column="company_id"/>
        <result property="status" column="status"/>
        <result property="companyName" column="company_name"/>
        <result property="userName" column="user_name"/>

    </resultMap>

    <sql id="selectSubscribeVo">
        SELECT
        s.user_id, s.company_id, s.status, u.user_name, c.company_name
        FROM (
        fea_user_company AS s LEFT JOIN sys_user AS u ON s.user_id = u.user_id
        )
        LEFT JOIN
        fea_company AS c ON c.company_id = s.company_id
    </sql>

    <select id="selectSubscribeList" parameterType="Subscribe" resultMap="SubscribeResult">
        <include refid="selectSubscribeVo"/>
        <where>
            <if test="userId != null and userId != ''">and s.user_id = #{userId}</if>
            <if test="companyId != null and companyId != ''">and s.company_id = #{companyId}</if>
            and 1=1
        </where>
    </select>

    <select id="selectSubscribeByUserId" parameterType="Long" resultMap="SubscribeResult">
        SELECT
        s.user_id, s.company_id, u.user_name, c.company_name
        FROM (
        fea_user_company AS s
        LEFT JOIN sys_user AS u ON s.user_id = u.user_id
        )
        LEFT JOIN fea_company AS c ON c.company_id = s.company_id
        WHERE s.user_id = #{userId}
    </select>

    <!--    <select id="selectSubscribeBySubscribeInfo" parameterType="Long" resultMap="SubscribeResult">-->
    <!--        SELECT-->
    <!--        s.user_id, s.company_id, u.user_name, c.company_name-->
    <!--        FROM (-->
    <!--        fea_user_company AS s-->
    <!--        LEFT JOIN sys_user AS u ON s.user_id = u.user_id-->
    <!--        )-->
    <!--        LEFT JOIN fea_company AS c ON c.company_id = s.company_id-->
    <!--        <where>-->
    <!--            <if test="userId != null and userId != ''">and user_id = #{userId}</if>-->
    <!--            <if test="companyId != null and companyId != ''">and company_id = #{companyId}</if>-->
    <!--            and 1=1-->
    <!--        </where>-->
    <!--    </select>-->

    <insert id="insertSubscribe" parameterType="Subscribe">
        <if test="userId != null and companyId != null">
            insert into fea_user_company

            <trim prefix="(" suffix=")" suffixOverrides=",">
                user_id, company_id
            </trim>

            <trim prefix="values (" suffix=")" suffixOverrides=",">
                #{userId}, #{companyId}
            </trim>
        </if>
    </insert>

    <delete id="unsubscribe" parameterType="Subscribe">
        <if test="userId != null and companyId != null">
            delete from fea_user_company where user_id = #{userId} and
            company_id = #{companyId}
        </if>
    </delete>

    <update id="updateSubscribe" parameterType="Subscribe">
        <if test="status != null and userId != null and companyId != null">
            update fea_user_company
            <trim prefix="SET" suffixOverrides=",">
                status = #{status}
            </trim>
            where user_id = #{userId} AND company_id = #{companyId}
        </if>
    </update>


    <delete id="deleteSubscribe" parameterType="Subscribe">
        delete from fea_user_company where user_id = #{userId} and company_id=#{companyId}
    </delete>

    <!--        <delete id="deleteSubscribeByUserIds" parameterType="String">-->
    <!--            delete from fea_user_company where user_id in-->
    <!--            <foreach item="userId" collection="array" open="(" separator="," close=")">-->
    <!--                #{userId}-->
    <!--            </foreach>-->
    <!--        </delete>-->

    <!--    <delete id="deleteCompanyByCompanyIds" parameterType="String">-->
    <!--        delete from fea_company where company_id in-->
    <!--        <foreach item="companyId" collection="array" open="(" separator="," close=")">-->
    <!--            #{companyId}-->
    <!--        </foreach>-->
    <!--    </delete>-->

    <!--    <delete id="deleteCompanyByCompanyId" parameterType="Long">-->
    <!--        delete from fea_company where company_id = #{companyId}-->
    <!--    </delete>-->

    <!--    <insert id="batchCompany">-->
    <!--        insert into fea_company( company_id, company_name, company_address, email, found_time, certificate, additional_info, apply_date, company_master, create_by, create_time, update_by, update_time) values-->
    <!--        <foreach item="item" index="index" collection="list" separator=",">-->
    <!--            ( #{item.companyId}, #{item.companyName}, #{item.companyAddress}, #{item.email}, #{item.foundTime}, #{item.certificate}, #{item.additionalInfo}, #{item.applyDate}, #{item.companyMaster}, #{item.createBy}, #{item.createTime}, #{item.updateBy}, #{item.updateTime})-->
    <!--        </foreach>-->
    <!--    </insert>-->
</mapper>